# Living Collage Maker - 제품 요구사항 문서 (PRD)

## 1. 제품 개요

Living Collage Maker는 사용자가 가구를 드래그 앤 드롭으로 배치하여 인테리어 콜라주를 만들 수 있는 애플리케이션입니다. 사용자는 다양한 가구를 캔버스에 배치하고, 크기를 조절하며, 최종 결과물을 저장할 수 있습니다.

## 2. 핵심 기능

### 2.1 가구 탐색 및 필터링
- 가구 목록을 테이블 형태로 표시
- 각 가구 항목은 썸네일, 브랜드, 이름, 가격 정보 포함
- 필터링 기능:
  - 검색어로 가구 검색
  - 브랜드별 필터링
  - 타입별 필터링
  - 가격대별 필터링

### 2.2 드래그 앤 드롭 기능
- 가구 목록에서 캔버스로 드래그 앤 드롭
- 드래그 시 가구 데이터를 MIME 데이터로 전송
- 드롭 시 가구 이미지를 캔버스에 표시
- 드롭된 가구는 자유롭게 이동 및 크기 조절 가능
  - 크기 조절 시 원본 비율 무시하고 자유롭게 변형 가능

### 2.2.2 가구 아이템 기능
- **기본 동작**
  - 드래그 앤 드롭으로 캔버스에 배치
  - 자유로운 위치 이동
  - 우클릭 메뉴로 삭제 및 좌우 반전 기능 제공
  - 최소 크기: 100x100 픽셀

- **크기 조절 기능**
  - 우측 하단의 리사이즈 핸들을 드래그하여 크기 조절
  - Shift 키를 누르지 않고 드래그:
    - 이미지가 위젯을 꽉 채우도록 자유롭게 크기 조절
    - 원본 이미지 비율 무시
  - Shift 키를 누른 상태로 드래그:
    - 원본 이미지 비율 유지
    - 이미지가 중앙에 배치되며 비율에 맞게 크기 조절

- **이미지 표시**
  - 비율 유지 모드: 이미지가 중앙에 배치되며 원본 비율 유지
  - 비율 무시 모드: 이미지가 위젯을 꽉 채우도록 표시
  - 이미지 로드 실패 시 회색 배경에 오류 메시지 표시

### 2.3 캔버스 관리
- 새 콜라주 생성 시 캔버스 크기 설정 가능
- 캔버스 크기에 맞춰 윈도우 크기 자동 조정
- 캔버스 테두리와 크기 표시
- 가구 아이템 우클릭 메뉴:
  - 삭제 기능
  - 좌우 반전 기능

### 2.4 이미지 관리
- 이미지 캐싱 시스템 구현
  - `.image` 폴더에 PNG 형식으로 저장
  - 메모리 캐시와 디스크 캐시 이중 구조
  - 약한 참조(Weak Reference)를 사용한 메모리 관리
  - 이미지 크기 최적화 (최대 1920px)
  - 이미지 품질 최적화 (85% 품질)
- 비동기 이미지 로딩
  - 스레드 풀을 사용한 병렬 처리
  - UI 블로킹 방지
  - 로딩 상태 관리
- 썸네일 생성 및 캐싱
- 이미지 로드 실패 시 기본 이미지 표시

### 2.5 하단 패널
- 선택된 가구 목록 표시
- 선택된 가구 수 표시
- 총 가격 계산 및 표시
- 가구 삭제 시 자동 업데이트

### 2.6 콜라주 내보내기
- 현재 콜라주를 이미지로 저장
- PNG/JPEG 형식 지원
- 저장 위치 선택 가능

### 2.7 작업 내용 저장/불러오기
- **저장 데이터**
  - 캔버스 정보
    - 캔버스 크기 (width, height)
    - 작업 제목/설명
    - 저장 시간
    - 마지막 수정 시간
    - 작업 버전
  - 가구 정보
    - 데이터베이스 ID
    - 위치 (x, y 좌표)
    - 크기 (width, height)
    - z-order (레이어 순서)
    - 좌우 반전 여부

- **저장 형식**
  - JSON 형식으로 저장
  - 파일 확장자: .json

- **기능**
  - 작업 내용 저장
  - 작업 내용 불러오기

## 3. 기술 스택

### 3.1 프론트엔드
- PyQt6
- QTableView 및 QStandardItemModel
- QGraphicsView (향후 구현 예정)

### 3.2 백엔드
- Python
- Supabase (데이터베이스 및 이미지 저장)
- SQLite (로컬 캐시)

## 4. 데이터 모델

### 4.1 가구 (Furniture)
```python
@dataclass
class Furniture:
    # 필수 필드
    id: str
    brand: str
    name: str
    image_filename: str
    price: int
    type: str
    
    # 선택적 필드 (기본값 설정)
    description: str = ''
    link: str = ''
    color: str = ''
    locations: List[str] = field(default_factory=list)
    styles: List[str] = field(default_factory=list)
    width: int = 0
    depth: int = 0
    height: int = 0
    seat_height: Optional[int] = None
    author: str = ''
    created_at: str = ''
```

## 5. UI/UX 디자인

### 5.1 레이아웃
- 메인 윈도우: 1200x800 기본 크기
- 캔버스: 사용자 정의 크기 (최소 800x600)
- 우측 패널: 400px 고정 너비
- 하단 패널: 200px 고정 높이

### 5.2 색상 테마
- 배경: 흰색 (#FFFFFF)
- 주요 색상: #2C3E50
- 강조 색상: #E74C3C (삭제 버튼)
- 테두리: #DDDDDD

## 6. 성능 요구사항
- 이미지 로딩 시간: 1초 이내
- 드래그 앤 드롭 반응성: 16ms 이내
- 필터링 응답 시간: 100ms 이내
- 메모리 사용량 최적화
  - 약한 참조를 사용한 메모리 관리
  - 이미지 크기 및 품질 최적화
  - 비동기 로딩으로 UI 반응성 유지

## 7. 향후 개선사항 (To-do List)

### 7.1 우선순위 높음
- [x] 이미지 최적화 및 캐시 관리 개선
- [x] 에러 처리 및 사용자 피드백 강화
- [x] 가구 좌우 반전 기능 구현
- [ ] 가구 회전 기능 구현
- [ ] 가구 크기 조절 시 그리드 스냅 기능
- [x] 작업 내용 저장/불러오기 기능
  - [x] 기본 저장/불러오기 구현

### 7.2 우선순위 중간
- [ ] 가구 배치 히스토리 (실행 취소/다시 실행)
- [ ] 가구 그룹화 기능
- [ ] 가구 정렬 기능
- [ ] 가구 복제 기능
- [ ] 가구 레이어 관리

### 7.3 우선순위 낮음
- [ ] 3D 뷰 모드
- [ ] 가구 커스터마이징 기능
- [ ] 가구 추천 시스템
- [ ] 공유 기능
- [ ] 가구 가격 비교 기능

## 8. 제한사항
- 최대 캔버스 크기: 4000x4000 픽셀
- 최대 가구 개수: 100개
- 지원 이미지 형식: JPG, PNG
- 최대 이미지 크기: 5MB
- 이미지 최적화: 최대 1920px, 85% 품질

## 9. 테스트 요구사항
- 단위 테스트: 모든 핵심 기능
- 통합 테스트: 데이터베이스 연동
- UI 테스트: 모든 사용자 상호작용
- 성능 테스트: 대용량 데이터 처리
- 메모리 누수 테스트
- 스레드 안전성 테스트

## 10. 배포 요구사항
- Python 3.8 이상
- PyQt6 6.4.0 이상
- Supabase 클라이언트 라이브러리
- 인터넷 연결 필요
- 최소 4GB RAM
- 최소 1GB 저장 공간 